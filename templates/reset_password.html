<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verify.ai - Reset Password</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <style>
      /* --- Gaya Dasar (Desktop First) --- */
      :root {
        --primary-color: #008060;
        /* Warna hijau tua yang baru */
        --primary-color-dark: #00664d;
        --google-color: #db4437;
        --facebook-color: #3b5998;
        --light-gray: #f4f4f4;
        --dark-text: #333;
        --medium-text: #666;
        /* Menambahkan variabel warna untuk konsistensi */
        --success-color: #28a745; /* Disesuaikan dengan warna btn-primary */
        --danger-color: #dc3545; /* Disesuaikan dengan warna invalid */
        --warning-color: #ffc107;
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      /* Style Dasar untuk Semua Tampilan */
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;

        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background-color: var(--light-gray);
        color: var(--dark-text);
      }

      .login-container {
        display: flex;

        max-width: 1200px;
        margin: 20px auto;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .login-left {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #d3f8e2;
        overflow: hidden;
      }

      .login-bg-video {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .login-right {
        flex: 1;
        padding: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      .login-form-wrapper {
        width: 100%;
        max-width: 400px;
        text-align: center;
      }

      .login-form h1 {
        margin-bottom: 20px;
        color: #333;
      }

      .login-form p {
        color: #666;
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 20px;
        text-align: left;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-size: 0.9rem;
        font-weight: 500;
      }

      .form-group input {
        box-sizing: border-box;
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }
      .forgot-password {
        font-size: 0.9rem;
        color: #007bff;
        text-decoration: none;
        white-space: nowrap;
        margin-left: 20px;
      }
      .forgot-password:hover {
        text-decoration: underline;
      }

      /* Wrapper untuk input dan ikon */
      .password-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
      }

      .password-input-wrapper input {
        padding-right: 40px;
      }

      /* Gaya untuk ikon mata */
      .password-toggle-icon {
        position: absolute;
        right: 15px;
        color: #999;
        cursor: pointer;
      }
      .password-meta-info {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-top: 8px;
      }

      /* Gaya untuk notifikasi syarat password */
      .password-requirements {
        margin-top: 8px;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .password-requirements span {
        font-size: 0.85rem;
        color: #a0a0a0;
        transition: color 0.3s ease;
      }

      /* Gaya saat syarat TERPENUHI (valid) */
      .password-requirements span.valid {
        color: var(--success-color); /* Menggunakan variabel CSS */
        text-decoration: line-through;
      }

      /* Gaya saat syarat BELUM TERPENUHI (invalid) saat user mengetik */
      .password-requirements span.invalid {
        color: var(--danger-color); /* Menggunakan variabel CSS */
      }

      /* --- CSS UNTUK VALIDASI FORM REAL-TIME --- */

      /* Gaya dasar untuk pesan notifikasi */
      .validation-message {
        display: block;
        margin-top: 6px;
        font-size: 0.85rem;
        font-weight: 500;
        height: 15px; /* Beri tinggi tetap agar layout tidak "loncat" */
      }

      /* Gaya untuk input yang VALID */
      .form-group input.is-valid {
        border-color: var(--success-color);
        box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.3);
      }

      /* Gaya untuk pesan notifikasi VALID */
      .validation-message.is-valid {
        color: var(--success-color);
      }

      /* Gaya untuk input yang INVALID */
      .form-group input.is-invalid {
        border-color: var(--danger-color);
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.3);
      }

      /* Gaya untuk pesan notifikasi INVALID */
      .validation-message.is-invalid {
        color: var(--danger-color);
      }

      .btn-primary {
        background-color: var(--success-color);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
        width: 100%;
        margin-top: 20px;
      }

      .login-separator {
        display: flex;
        align-items: center;
        text-align: center;
        margin: 30px 0;
        color: #999;
      }

      .login-separator::before,
      .login-separator::after {
        content: "";
        flex-grow: 1;
        background-color: #ddd;
        height: 1px;
        margin: 0 15px;
      }

      .social-login button {
        display: block;
        width: 100%;
        padding: 12px 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
        margin-bottom: 10px;
        text-align: center;
        text-decoration: none;
      }

      .btn-social.google {
        color: #db4437;
        background-color: white;
      }

      .btn-social.facebook {
        color: white;
        background-color: #3b5998;
      }

      .signup-prompt {
        margin-top: 30px;
        font-size: 14px;
        color: #777;
      }

      .signup-prompt a {
        color: #007bff;
        text-decoration: none;
      }

      .login-footer {
        text-align: center;
        padding: 15px;
        color: #777;
        font-size: 12px;
        margin-top: 20px;
      }

      /* Gaya untuk flash messages */
      .flash-messages {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }
        .flash-messages li {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 10px;
            color: white;
            font-weight: 500;
        }
        .flash-danger {
            background-color: var(--danger-color);
        }
        .flash-warning {
            background-color: var(--warning-color);
            color: #333;
        }
        .flash-success {
            background-color: var(--success-color);
        }


      /* Media Query untuk Mobile */
      @media (max-width: 768px) {
        .login-page-wrapper {
          padding: 0;
          align-items: stretch;
        }

        body {
          background-color: #fff;
        }

        .login-container {
          display: flex;
          width: 100%;
          background-color: white;
          overflow: hidden;
        }

        .login-left {
          display: flex;
          flex: 0 0 35vh;
          border-radius: 0 0 30px 30px;
          overflow: hidden;
        }

        .login-right {
          background-color: #fff;
          border-radius: 30px 30px 0 0;
          margin-top: -25px;
          position: relative;
          z-index: 2;
          padding: 30px;
          display: block;
        }

        .login-form-wrapper {
          margin: 0;
          max-width: 100%;
        }

        .login-footer {
          display: block;
          background-color: #fff;
          padding: 0 20px 20px 20px;
          color: #aaa;
        }
      }

      /* --- Tablet (Portrait) & Ponsel Besar (Landscape) --- */
      @media (max-width: 992px) {
        .login-container {
          flex-direction: column;
          max-width: 500px;
        }

        .login-left {
          flex: 0 0 250px;
        }

        .login-right {
          padding: 40px;
        }
      }

      /* --- Ponsel (Portrait) --- */
      @media (max-width: 480px) {
        .login-form-wrapper {
          padding: 25px;
        }

        .login-form-wrapper h1 {
          font-size: 1.8rem;
        }

        .login-form-wrapper p,
        .form-group input,
        .btn-primary,
        .social-login button {
          font-size: 0.95rem;
        }
      }
    </style>
  </head>

  <body>
    <div class="login-container">
      <div class="login-left">
        <video playsinline autoplay loop muted class="login-bg-video">
          <source
            src="{{ url_for('static', filename='Image/verify1.mp4') }}"
            type="video/mp4"
          />
        </video>
      </div>
      <div class="login-right">
        <div class="login-form-wrapper">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <ul class="flash-messages">
              {% for category, message in messages %}
              <li class="flash-{{ category }}">{{ message }}</li>
              {% endfor %}
            </ul>
            {% endif %}
            {% endwith %}
          <h1>Silahkan masukkan password baru andaðŸ‘‹</h1>
          
          <form class="login-form" method="POST" action="{{ url_for('reset_with_otp') }}">
            <div class="form-group">
                <label for="password">Password Baru</label>
                <div class="password-input-wrapper">
                    <input
                        type="password"
                        id="password"
                        name="password" placeholder="Masukkan password baru Anda"
                        required
                    />
                    <i class="fas fa-eye-slash password-toggle-icon" id="toggle-password"></i>
                </div>
                <div class="password-meta-info">
                    <div class="password-requirements">
                        <span id="req-length">Minimal 8 karakter</span>
                        <span id="req-capital">Minimal 1 huruf kapital</span>
                        <span id="req-number">Minimal 1 angka</span>
                        <span id="req-symbol">Minimal 1 simbol</span>
                    </div>
                </div>
                <span class="validation-message" id="password-message"></span>
            </div>
        
            <div class="form-group">
                <label for="confirm_password">Konfirmasi Password Baru</label>
                <div class="password-input-wrapper">
                    <input
                        type="password"
                        id="confirm_password" name="confirm_password" placeholder="Ketik ulang password baru Anda"
                        required
                    />
                    <i class="fas fa-eye-slash password-toggle-icon" id="toggle-confirm-password"></i>
                </div>
                <span class="validation-message" id="confirm-password-message"></span>
            </div>
            
            <button type="submit" class="btn-primary">Reset Password</button>
          </form>

          <p class="signup-prompt">Kembali ke halaman login? <a href="{{ url_for('login') }}">Masuk Kembali</a></p>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- JAVASCRIPT UNTUK VALIDASI PASSWORD REAL-TIME & TOGGLE LIHAT/SEMBUNYIKAN ---

        const passwordInput = document.getElementById("password");
        const confirmPasswordInput = document.getElementById("confirm_password");
        const passwordMessage = document.getElementById("password-message");
        const confirmPasswordMessage = document.getElementById("confirm-password-message");

        // Elements for password requirements
        const reqLength = document.getElementById("req-length");
        const reqCapital = document.getElementById("req-capital");
        const reqNumber = document.getElementById("req-number");
        const reqSymbol = document.getElementById("req-symbol");

        // Elements for password toggle
        const togglePassword = document.getElementById("toggle-password");
        const toggleConfirmPassword = document.getElementById("toggle-confirm-password");

        // Function to toggle password visibility
        function setupPasswordToggle(inputElement, toggleIconElement) {
            if (inputElement && toggleIconElement) { // Defensive check
                toggleIconElement.addEventListener("click", () => {
                    const type = inputElement.getAttribute("type") === "password" ? "text" : "password";
                    inputElement.setAttribute("type", type);
                    toggleIconElement.classList.toggle("fa-eye");
                    toggleIconElement.classList.toggle("fa-eye-slash");
                });
            }
        }

        // Setup toggles for both password fields
        setupPasswordToggle(passwordInput, togglePassword);
        setupPasswordToggle(confirmPasswordInput, toggleConfirmPassword);


        // Function to validate password strength
        function validatePasswordStrength(passwordValue) {
            let isValid = true;

            // Pastikan elemen syarat ada sebelum mencoba mengaksesnya
            // Length
            if (reqLength) { // Check if element exists
                if (passwordValue.length >= 8) {
                    reqLength.classList.add("valid");
                    reqLength.classList.remove("invalid");
                } else {
                    reqLength.classList.add("invalid");
                    reqLength.classList.remove("valid");
                    isValid = false;
                }
            } else {
                 console.warn("Element req-length not found. Check HTML IDs.");
            }

            // Capital letter
            if (reqCapital) { // Check if element exists
                if (/[A-Z]/.test(passwordValue)) {
                    reqCapital.classList.add("valid");
                    reqCapital.classList.remove("invalid");
                } else {
                    reqCapital.classList.add("invalid");
                    reqCapital.classList.remove("valid");
                    isValid = false;
                }
            } else {
                 console.warn("Element req-capital not found. Check HTML IDs.");
            }

            // Number
            if (reqNumber) { // Check if element exists
                if (/[0-9]/.test(passwordValue)) {
                    reqNumber.classList.add("valid");
                    reqNumber.classList.remove("invalid");
                } else {
                    reqNumber.classList.add("invalid");
                    reqNumber.classList.remove("valid");
                    isValid = false;
                }
            } else {
                 console.warn("Element req-number not found. Check HTML IDs.");
            }

            // Symbol
            if (reqSymbol) { // Check if element exists
                if (/[!@#$%^&*(),.?":{}|<>]/.test(passwordValue)) {
                    reqSymbol.classList.add("valid");
                    reqSymbol.classList.remove("invalid");
                } else {
                    reqSymbol.classList.add("invalid");
                    reqSymbol.classList.remove("valid");
                    isValid = false;
                }
            } else {
                 console.warn("Element req-symbol not found. Check HTML IDs.");
            }

            return isValid;
        }


        // Event listener for password input
        // Added checks for all required elements before adding listener to prevent console errors on missing elements
        if (passwordInput && passwordMessage && reqLength && reqCapital && reqNumber && reqSymbol && confirmPasswordInput && confirmPasswordMessage) {
            passwordInput.addEventListener("input", () => {
                const passwordValue = passwordInput.value;
                const confirmPasswordValue = confirmPasswordInput.value; // Get value directly from input

                // Reset all requirements if password is empty
                if (passwordValue.length === 0) {
                    reqLength.classList.remove("valid", "invalid");
                    reqCapital.classList.remove("valid", "invalid");
                    reqNumber.classList.remove("valid", "invalid");
                    reqSymbol.classList.remove("valid", "invalid");
                    passwordInput.classList.remove("is-valid", "is-invalid");
                    passwordMessage.textContent = "";
                    passwordMessage.classList.remove("is-valid", "is-invalid"); // Clear message classes
                } else {
                    const isPasswordStrong = validatePasswordStrength(passwordValue);
                    if (isPasswordStrong) {
                        passwordInput.classList.add("is-valid");
                        passwordInput.classList.remove("is-invalid");
                        passwordMessage.textContent = "Password memenuhi syarat.";
                        passwordMessage.classList.add("is-valid");
                        passwordMessage.classList.remove("is-invalid");
                    } else {
                        passwordInput.classList.add("is-invalid");
                        passwordInput.classList.remove("is-valid");
                        passwordMessage.textContent = "Password tidak memenuhi syarat.";
                        passwordMessage.classList.add("is-invalid");
                        passwordMessage.classList.remove("is-valid");
                    }
                }

                // Always re-check confirm password when main password changes
                if (confirmPasswordInput.value.length > 0) { // Only validate if confirm field has content
                    if (passwordValue === confirmPasswordValue) {
                        confirmPasswordInput.classList.add("is-valid");
                        confirmPasswordInput.classList.remove("is-invalid");
                        confirmPasswordMessage.textContent = "Password cocok.";
                        confirmPasswordMessage.classList.add("is-valid");
                        confirmPasswordMessage.classList.remove("is-invalid");
                    } else {
                        confirmPasswordInput.classList.add("is-invalid");
                        confirmPasswordInput.classList.remove("is-valid");
                        confirmPasswordMessage.textContent = "Password tidak cocok.";
                        confirmPasswordMessage.classList.add("is-invalid");
                        confirmPasswordMessage.classList.remove("is-valid");
                    }
                } else {
                    // If confirm is empty, ensure no validation styles are applied
                    confirmPasswordInput.classList.remove("is-valid", "is-invalid");
                    confirmPasswordMessage.textContent = "";
                    confirmPasswordMessage.classList.remove("is-valid", "is-invalid");
                }
            });
        }

        // Event listener for confirm password input (to ensure it reacts independently too)
        // Added checks for all required elements before adding listener to prevent console errors on missing elements
        if (confirmPasswordInput && confirmPasswordMessage && passwordInput) {
            confirmPasswordInput.addEventListener("input", () => {
                const passwordValue = passwordInput.value;
                const confirmPasswordValue = confirmPasswordInput.value;

                if (confirmPasswordValue.length === 0) {
                    confirmPasswordInput.classList.remove("is-valid", "is-invalid");
                    confirmPasswordMessage.textContent = "";
                    confirmPasswordMessage.classList.remove("is-valid", "is-invalid");
                } else if (passwordValue === confirmPasswordValue) {
                    confirmPasswordInput.classList.add("is-valid");
                    confirmPasswordInput.classList.remove("is-invalid");
                    confirmPasswordMessage.textContent = "Password cocok.";
                    confirmPasswordMessage.classList.add("is-valid");
                    confirmPasswordMessage.classList.remove("is-invalid");
                } else {
                    confirmPasswordInput.classList.add("is-invalid");
                    confirmPasswordInput.classList.remove("is-valid");
                    confirmPasswordMessage.textContent = "Password tidak cocok.";
                    confirmPasswordMessage.classList.add("is-invalid");
                    confirmPasswordMessage.classList.remove("is-valid"); // Fix: Ensure 'is-valid' is removed
                }
            });
        }
        if (passwordInput && passwordInput.value.length > 0) {
            passwordInput.dispatchEvent(new Event('input'));
        }
        if (confirmPasswordInput && confirmPasswordInput.value.length > 0) {
            confirmPasswordInput.dispatchEvent(new Event('input'));
        }
      });
    </script>

    <footer class="login-footer">Machine Learning Kelompok 4</footer>
  </body>
</html>